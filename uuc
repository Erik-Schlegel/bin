#!/bin/bash
# Update, upgrade, and clean the update cache.

set -e  # Exit on error

sudo apt update
sudo apt upgrade -y
sudo apt dist-upgrade -y
sudo apt autoremove -y

sudo apt autoclean
rc_pkgs=$(dpkg -l | awk '/^rc/ {print $2}')
if [ -n "$rc_pkgs" ]; then
  sudo dpkg --purge $rc_pkgs
fi

sudo apt clean

# Keep current logs; clean old logs.
sudo find /var/log -type f -name "*.gz" -delete
sudo find /var/log -type f -name "*.1" -delete
sudo journalctl --vacuum-time=2weeks

# Update/clean Flatpak if installed
if command -v flatpak >/dev/null 2>&1; then
  flatpak update -y
  flatpak uninstall --unused -y
else
  echo "Flatpak not installed; skipping Flatpak steps."
fi

echo "System maintenance complete!"
